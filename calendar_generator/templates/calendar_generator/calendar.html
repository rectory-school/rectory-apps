{% extends 'calendar_generator/base.html' %}
{% load static django_bootstrap_breadcrumbs %}

{% block title %}Calendar: {{ object.title }}{% endblock %}

{% block headextra %}
    {{ block.super }}

    <link rel="stylesheet" href="{% static 'calendar_generator/calendar.css' %}">
{% endblock %}

{% block breadcrumbs %}
    {{ block.super }}

    {% breadcrumb calendar.title calendar %}    
{% endblock %}

{% block content %}
<h1>
    Calendar: {{ calendar.title }}
</h1>

<p><em>{{ calendar.start_date }} to {{ calendar.end_date }}</em>

{% if has_admin_access and perms.calendar_generator.add_calendar %}
    <p class="noprint"><a href="{% url 'admin:calendar_generator_calendar_change' object_id=object.id %}">Edit this calendar</a></p>
{% endif %}

<h2 class="noprint">PDF Links</h2>
<ul class="noprint">
    <li>Full year calendar: 
        {% for i, name in style_presets %}
            <a href="{% url 'calendar_generator:one-page-pdf' calendar_id=object.pk style_index=i %}">{{ name }}</a>
            {% if not forloop.last %}
                &bullet;
            {% endif %}
        {% endfor %}
    </li>

    <li>Monthly calendars:
        {% for i, name in style_presets %}
            <a href="{% url 'calendar_generator:months-pdf' calendar_id=object.pk style_index=i %}">{{ name }}</a>
            {% if not forloop.last %}
                &bullet;
            {% endif %}
        {% endfor %}
    </li>

    <li>Monthly calendars for embedding:
        {% for i, name in style_presets %}
            <a href="{% url 'calendar_generator:months-pdf' calendar_id=object.pk style_index=i %}?embedded">{{ name }}</a>
            {% if not forloop.last %}
                &bullet;
            {% endif %}
        {% endfor %}
    </li>
    <li>
        <a href="#modal-custom-calendar" data-toggle="modal">Custom PDF</a>
    </li>
</ul>

{% if today_letter %}
    <h2 class="noprint">Today</h2>
    <p class="noprint"><strong>{{ today }}: {{ today_letter }}</strong></p>
{% endif %}

<h2>Day Rotation</h2>
<p>
    {% for letter in day_rotation %}
        {{ letter }}
        {% if not forloop.last %} &bullet; {% endif %}
    {% endfor %}
</p>

{% if skipped_days %}
    <h2>Days Out of Rotation</h2>
    <ul>

        {% for start, end in skipped_days %}
        <li>
            {{ start }}
            {% if end %}
                through {{ end }}
            {% endif %}
        </li>
        {% endfor %}
    </ul>
{% endif %}

{% if reset_days %}
    <h2>Days where the rotation is reset</h2>
    <ul>
        {% for date, letter in reset_days %}
            <li>{{ date }} resets to "{{ letter }}"</li>
        {% endfor %}
    </ul>
{% endif %}

{% for calendar in calendars %}
<div class="calendar">
    <h2>{{ calendar.first_date|date:"F Y" }}</h2>
    <p class="noprint">
        {% for i, name in style_presets %}
            <a href="{% url 'calendar_generator:month-pdf' calendar_id=object.pk style_index=i year=calendar.year month=calendar.month %}">{{ name }}</a>
            &bullet;
        {% endfor %}

        {% for i, name in style_presets %}
            <a href="{% url 'calendar_generator:month-pdf' calendar_id=object.pk style_index=i year=calendar.year month=calendar.month %}?embedded">{{ name }} Embedded</a>
            
            {% if not forloop.last %}
                &bullet;
            {% endif %}
        {% endfor %}
    </p>

    <table class="table table-bordered">
        <thead>
            {% for header in calendar.grid.headers %}
                <th scope="col">{{ header }}</th>
            {% endfor %}
        </thead>
        <tbody>
            {% for week in calendar.grid.grid %}
            <tr>
                {% for day in week %}
                <td>
                    {% if day %}
                        <span class="date">{{ day.date.day }}</span>

                        {% if day.letter %}
                            {% if day.is_label %}
                                <span class="label">{{ day.letter }}</span>
                            {% else %}
                                <span class="letter">{{ day.letter }}</span>
                            {% endif %}
                        {% endif %}
                    {% endif %}
                </td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endfor %}

<div class="modal" tabindex="-1" role="dialog" id="modal-custom-calendar">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Generate a Custom Calendar</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form class="noprint" action="{% url 'calendar_generator:custom-pdf' calendar_id=object.id %}">
                    <div class="form-group">
                        <label for="customCalendarSize">Size</label>
                        
                        <select class="form-control" name="size" id="customCalendarSize">
                            <option value="print">Print</option>
                            <option value="embedded">Embedded</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="customCalendarTitle">Title</label>
                        
                        <input type="text" class="form-control" name="title" id="customCalendarTitle" value="{{ object.title }}">
                    </div>

                    <div class="form-group">
                        <label for="customCalendarColor">Color style</label>
                        
                        <select class="form-control" name="style" id="customCalendarColor">
                            {% for i, name in style_presets %}
                                <option value="{{ i }}">{{ name }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="customCalendarStart">Start date</label>
                        <input type="date" class="form-control" name="start-date" id="customCalendarStart" value={{ object.start_date|date:"Y-m-d" }}>
                    </div>
                    
                    <div class="form-group">
                        <label for="customCalendarEnd">End date</label>
                        <input type="date" class="form-control" name="end-date" id="customCalendarEnd" value={{ object.end_date|date:"Y-m-d" }}>
                    </div>

                    <button type="submit" class="btn btn-primary">Get calendar</button>
                </form>
            </div>
        </div>
    </div>
</div>
        

{% endblock %}