{% extends 'calendar_generator/calendar_base.html' %}
{% load static bootstrap4 django_bootstrap_breadcrumbs %}

{% block title %}Calendar: {{ object.title }}{% endblock %}

{% block headextra %}
    {{ block.super }}

    <link rel="stylesheet" href="{% static 'calendar_generator/calendar.css' %}">
{% endblock %}



{% block content %}
<h1>
    Calendar: {{ calendar.title }}
</h1>

<p><em>{{ calendar.start_date }} to {{ calendar.end_date }}</em>

{% if has_admin_access and perms.calendar_generator.add_calendar %}
    <p class="noprint"><a href="{% url 'admin:calendar_generator_calendar_change' object_id=object.id %}">Edit this calendar</a></p>
{% endif %}

<h2 class="noprint">PDF Links</h2>
{% for layout_index, layout_name in layouts %}
    <h3 class="noprint">{{ layout_name }}</h3>
    <ul class="noprint">
        {% for style_index, style_name in styles %}
            <li>
                {{ style_name }}: <a href="{% url 'calendar_generator:months-pdf' calendar_id=object.pk layout_index=layout_index style_index=style_index %}">All months</a>
                &bullet;
                    <a href="{% url 'calendar_generator:one-page-pdf' calendar_id=object.pk layout_index=layout_index style_index=style_index %}">One Page</a>
            </li>
        {% endfor %}
    </ul>
{% endfor %}

    
<p class="noprint"><a href="{% url 'calendar_generator:custom-pdf' calendar_id=calendar.pk %}">Custom PDF Generator</a></p>
    
{% if today_letter %}
    <h2 class="noprint">Today</h2>
    <p class="noprint"><strong>{{ today }}: {{ today_letter }}</strong></p>
{% endif %}

<h2>Day Rotation</h2>
<p>
    {% for letter in day_rotation %}
        {{ letter }}
        {% if not forloop.last %} &bullet; {% endif %}
    {% endfor %}
</p>

{% if skipped_days %}
    <h2>Days Out of Rotation</h2>
    <ul>

        {% for start, end in skipped_days %}
        <li>
            {{ start }}
            {% if end %}
                through {{ end }}
            {% endif %}
        </li>
        {% endfor %}
    </ul>
{% endif %}

{% if reset_days %}
    <h2>Days where the rotation is reset</h2>
    <ul>
        {% for date, letter in reset_days %}
            <li>{{ date }} resets to "{{ letter }}"</li>
        {% endfor %}
    </ul>
{% endif %}

{% for calendar in calendars %}
<div class="calendar">
    <h2>{{ calendar.first_date|date:"F Y" }}</h2>
    <ul class="noprint">
        {% for style_index, style_name in styles %}
            {% for layout_index, layout_name in layouts %}
                <li>
                    <a href="{% url 'calendar_generator:month-pdf' calendar_id=object.pk style_index=style_index layout_index=layout_index year=calendar.year month=calendar.month %}">{{ style_name }}: {{ layout_name }}</a>
                </li>
            {% endfor %}
        {% endfor %}
    </ul>

    <table class="table table-bordered">
        <thead>
            {% for header in calendar.grid.headers %}
                <th scope="col">{{ header }}</th>
            {% endfor %}
        </thead>
        <tbody>
            {% for week in calendar.grid.grid %}
            <tr>
                {% for day in week %}
                <td>
                    {% if day %}
                        <span class="date">{{ day.date.day }}</span>

                        {% if day.letter %}
                            {% if day.is_label %}
                                <span class="label">{{ day.letter }}</span>
                            {% else %}
                                <span class="letter">{{ day.letter }}</span>
                            {% endif %}
                        {% endif %}
                    {% endif %}
                </td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endfor %}      

{% endblock %}